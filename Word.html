<!doctype html>
<html lang="hi">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Full Multi-File Rich Text Editor</title>
    <style>
        :root {
            --sidebar: 260px;
            --gap: 10px
        }

        * {
            box-sizing: border-box;
            font-family: Inter, system-ui, Arial, sans-serif
        }

        body {
            margin: 0;
            display: flex;
            height: 100vh;
            background: #f4f6f8;
            color: #0f172a
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar);
            background: #0b1220;
            color: #fff;
            padding: 14px;
            overflow: auto
        }

        .sidebar h2 {
            margin: 0 0 8px;
            font-size: 18px
        }

        .btn {
            display: inline-block;
            padding: 8px 10px;
            border-radius: 6px;
            border: 0;
            background: #10b981;
            color: #fff;
            cursor: pointer;
            margin: 6px 0
        }

        .small {
            background: #1f2937;
            padding: 8px 10px;
            border-radius: 6px;
            border: 0;
            color: #fff;
            cursor: pointer;
            margin: 6px 0
        }

        .file-list {
            margin-top: 12px
        }

        .file-item {
            padding: 10px;
            border-radius: 6px;
            background: #0f172a;
            margin-bottom: 8px;
            cursor: pointer
        }

        .file-item.active {
            background: #15343a
        }

        .file-controls {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap
        }

        /* Main */
        .main {
            flex: 1;
            padding: 16px;
            display: flex;
            flex-direction: column
        }

        .toolbar {
            display: flex;
            gap: 8px;
            align-items: center;
            background: #fff;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 1px 4px rgba(2, 6, 23, .06)
        }

        .tool-btn {
            padding: 6px 10px;
            border-radius: 6px;
            border: 1px solid #e6edf3;
            background: #fff;
            cursor: pointer
        }

        select,
        input[type=color],
        input[type=text] {
            padding: 6px;
            border-radius: 6px;
            border: 1px solid #e6edf3
        }

        .editor {
            margin-top: 12px;
            background: #fff;
            flex: 1;
            padding: 18px;
            border-radius: 10px;
            border: 1px solid #e6edf0;
            overflow: auto
        }

        .statusbar {
            margin-top: 8px;
            font-size: 16px;
            color: #000000;
            display: flex;
            justify-content: space-between;
            align-items: center
        }

        .count {
            font-weight: 600
        }

        .titleEditable {
            width: 100%;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #e6edf3
        }

        @media (max-width:800px) {
            .sidebar {
                display: none
            }
        }
    </style>
</head>

<body>

    <!-- LEFT SIDEBAR -->
    <aside class="sidebar">
        <div class="file-controls">
            <button class="btn" id="newBtn">+ New</button>
            <button class="small" id="renameBtn">Rename</button>
            <button class="small" id="deleteBtn">Delete</button>
        </div>

        <hr>
        <div style="height: auto;"></div>

        <div class="file-list" id="fileList"></div>



        <div style="margin-top:12px;color:#cbd5e1;font-size:13px">
            Tip: हर document browser के <strong>localStorage</strong> में saved रहेगा — refresh पर वापस आएगा।
        </div>
    </aside>

    <!-- MAIN -->
    <main class="main">


        <div class="toolbar">

            <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px">
                <input id="docTitle" class="titleEditable" placeholder="Document title..." />
                <button class="tool-btn" id="saveBtn">Save</button>
                <div style="width: 20%;"></div>
                <button class="tool-btn" onclick="cmd('bold')"><b>B</b></button>
                <button class="tool-btn" onclick="cmd('italic')"><i>I</i></button>
                <button class="tool-btn" onclick="cmd('underline')"><u>U</u></button>

                <label>
                    <select id="colorSel" onchange="setColor(this.value)">
                        <option value="#000000">Black</option>
                        <option value="#b91c1c">Red</option>
                        <option value="#1e40af">Blue</option>
                        <option value="#047857">Green</option>
                        <option value="#f97316">Orange</option>
                    </select>
                </label>

                <label>
                    <select id="sizeSel" onchange="setSize(this.value)">
                        <option value="2">Small</option>
                        <option value="3" selected>Normal</option>
                        <option value="4">Large</option>
                        <option value="5">X-Large</option>
                    </select>
                </label>




                <div style="margin-left:auto;display:flex;gap:8px">
                    <button class="tool-btn" onclick="cmd('undo')">Undo</button>
                    <button class="tool-btn" onclick="cmd('redo')">Redo</button>


                    <button style="display: none;" class="tool-btn" id="downloadBtn"></button> <!--Download (.html)-->
                    <button style="display: none;" class="small" id="downloadAll"></button> <!--Download-->
                    <button style="display: none;" class="tool-btn" id="clearBtn"></button> <!--Clear-->


                </div>

            </div>
        </div>

        <div id="editor" class="editor" contenteditable="true" spellcheck="true">
            <p>नया दस्तावेज़ यहाँ लिखें...</p>
        </div>

        <div class="statusbar">
            
            <div class="count" id="selCount">Select text to see counts</div>
            <div id="savedAt">Saved: -</div>
        </div>
    </main>

    <script>
        /* ---------- Storage & data model ---------- */
        const KEY = 'multi_editor_v2';
        let docs = JSON.parse(localStorage.getItem(KEY) || '[]'); // each: {id, title, content, updated}
        let currentId = null;

        /* ---------- DOM ---------- */
        const fileList = document.getElementById('fileList');
        const editor = document.getElementById('editor');
        const docTitle = document.getElementById('docTitle');
        const savedAt = document.getElementById('savedAt');
        const selCount = document.getElementById('selCount');

        /* ---------- Helpers ---------- */
        function saveAll() {
            localStorage.setItem(KEY, JSON.stringify(docs));
            updateSavedTime();
        }

        function updateSavedTime() {
            const d = new Date();
            savedAt.textContent = 'Saved: ' + d.toLocaleString();
        }

        /* ---------- Render sidebar list ---------- */
        function renderFiles() {
            fileList.innerHTML = '';
            docs.forEach(doc => {
                const el = document.createElement('div');
                el.className = 'file-item' + (doc.id === currentId ? ' active' : '');
                el.textContent = doc.title || 'Untitled';
                el.onclick = () => openDoc(doc.id);
                fileList.appendChild(el);
            });
        }

        /* ---------- File operations ---------- */
        function newFile() {
            const id = Date.now().toString();
            const obj = { id, title: 'Untitled ' + (docs.length + 1), content: '<p></p>', updated: Date.now() };
            docs.unshift(obj); // newest first
            saveAll();
            renderFiles();
            openDoc(id);
        }

        function openDoc(id) {
            const d = docs.find(x => x.id === id);
            if (!d) return;
            currentId = id;
            editor.innerHTML = d.content || '<p></p>';
            docTitle.value = d.title || '';
            renderFiles();
            updateSavedTime();
            editor.focus();
        }

        function deleteCurrent() {
            if (!currentId) return alert('Koi document selected nahi hai');
            if (!confirm('Delete this document?')) return;
            docs = docs.filter(x => x.id !== currentId);
            saveAll();
            renderFiles();
            if (docs.length) openDoc(docs[0].id);
            else { currentId = null; editor.innerHTML = ''; docTitle.value = ''; savedAt.textContent = 'Saved: -'; }
        }

        function renameCurrent() {
            if (!currentId) return alert('Koi document selected nahi hai');
            const d = docs.find(x => x.id === currentId);
            const nv = prompt('New title:', d.title || '');
            if (nv === null) return;
            d.title = nv.trim() || d.title;
            d.updated = Date.now();
            saveAll(); renderFiles();
        }

        /* ---------- Editor commands ---------- */
        function cmd(c) {
            document.execCommand(c, false, null);
            scheduleSaveCurrent();
        }

        function setColor(v) {
            document.execCommand('foreColor', false, v);
            scheduleSaveCurrent();
        }
        function setSize(v) {
            document.execCommand('fontSize', false, v);
            scheduleSaveCurrent();
        }

        /* ---------- Save current doc ---------- */
        let saveTimer = null;
        function scheduleSaveCurrent() {
            if (!currentId) return;
            if (saveTimer) clearTimeout(saveTimer);
            saveTimer = setTimeout(() => {
                const d = docs.find(x => x.id === currentId);
                if (d) {
                    d.content = editor.innerHTML;
                    d.title = docTitle.value.trim() || d.title || 'Untitled';
                    d.updated = Date.now();
                    saveAll();
                    renderFiles();
                }
            }, 500);
        }

        /* manual save button */
        document.getElementById('saveBtn').addEventListener('click', () => {
            scheduleSaveCurrent();
            alert('Saved locally.');
        });

        /* Download current as simple HTML */
        document.getElementById('downloadBtn').addEventListener('click', () => {
            if (!currentId) return alert('Select a document first.');
            const d = docs.find(x => x.id === currentId);
            const name = (d.title || 'document').replace(/[^a-z0-9_\-]/gi, '_').toLowerCase() + '.html';
            const html = `<!doctype html><html><head><meta charset="utf-8"><title>${escapeHtml(d.title)}</title></head><body>${d.content}</body></html>`;
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = name; document.body.appendChild(a); a.click(); a.remove();
            URL.revokeObjectURL(url);
        });

        /* Download all (zipped is overkill) — provide combined HTML */
        document.getElementById('downloadAll').addEventListener('click', () => {
            if (!docs.length) return alert('No documents.');
            let html = '<!doctype html><html><head><meta charset="utf-8"><title>all_documents</title></head><body>';
            docs.forEach(d => {
                html += `<h2>${escapeHtml(d.title)}</h2>${d.content}<hr/>`;
            });
            html += '</body></html>';
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'all_documents.html'; document.body.appendChild(a); a.click(); a.remove();
            URL.revokeObjectURL(url);
        });

        /* Clear content */
        document.getElementById('clearBtn').addEventListener('click', () => {
            if (!currentId) return alert('No document selected');
            if (!confirm('Clear this document content?')) return;
            const d = docs.find(x => x.id === currentId);
            d.content = '<p></p>';
            editor.innerHTML = d.content;
            scheduleSaveCurrent();
        });

        /* Delete / Rename buttons */
        document.getElementById('deleteBtn').addEventListener('click', deleteCurrent);
        document.getElementById('renameBtn').addEventListener('click', renameCurrent);
        document.getElementById('newBtn').addEventListener('click', newFile);


        /* Title input -> save */
        docTitle.addEventListener('input', scheduleSaveCurrent);

        /* Editor events -> autosave + track selection counts */
        editor.addEventListener('input', scheduleSaveCurrent);
        editor.addEventListener('keyup', updateSelectionCount);
        editor.addEventListener('mouseup', updateSelectionCount);

        function updateSelectionCount() {
            const s = window.getSelection().toString();
            if (s && s.trim().length) {
                const words = s.trim().split(/\s+/).length;
                selCount.textContent = `Selected → Words: ${words} | Characters: ${s.length}`;
            } else {
                selCount.textContent = 'Select text to see counts';
            }
        }

        /* Utility: escape HTML for filenames/titles */
        function escapeHtml(str) {
            if (!str) return '';
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }

        /* Initialize: if no docs, create one */
        if (!docs || docs.length === 0) {
            docs = [{ id: Date.now().toString(), title: 'Untitled 1', content: '<p>नया दस्तावेज़</p>', updated: Date.now() }];
            saveAll();
        }

        /* Open first document by default and render files */
        renderFiles();
        openDoc(docs[0].id);

        /* Utility: keep selection count updated when user changes selection using keyboard too */
        document.addEventListener('selectionchange', () => {
            // only update when editor has focus (prevent counting selection in other UI)
            if (document.activeElement === editor || editor.contains(document.activeElement)) {
                updateSelectionCount();
            }
        });
    </script>

</body>

</html>
<!DOCTYPE html>
<html>
<head>
  <title>üì∑ ArUco Marker Detector</title>
  <style>
    body { text-align: center; font-family: sans-serif; background: #f2f2f2; }
    canvas, video { display: none; }
    #idDisplay { font-size: 24px; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>üîç Show a Marker to the Camera</h2>
  <video id="video" width="640" height="480" autoplay muted></video>
  <canvas id="canvas" width="640" height="480"></canvas>
  <div id="idDisplay">üéØ Marker ID: --</div>

  <script async src="https://docs.opencv.org/4.x/opencv.js" onload="onOpenCvReady();" type="text/javascript"></script>
  <script type="text/javascript">
    let video = document.getElementById('video');
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    let idDisplay = document.getElementById("idDisplay");

    async function startCamera() {
      let stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
      video.play();
    }

    function onOpenCvReady() {
      startCamera().then(() => {
        let cap = new cv.VideoCapture(video);
        let src = new cv.Mat(video.height, video.width, cv.CV_8UC4);
        let gray = new cv.Mat();
        let dictionary = new cv.aruco.getPredefinedDictionary(cv.aruco.DICT_6X6_50);
        let ids = new cv.Mat();
        let corners = new cv.MatVector();

        function process() {
          cap.read(src);
          cv.cvtColor(src, gray, cv.COLOR_RGBA2GRAY, 0);
          cv.aruco.detectMarkers(gray, dictionary, corners, ids);

          if (!ids.empty()) {
            let idList = [];
            for (let i = 0; i < ids.rows; i++) {
              idList.push(ids.intPtr(i)[0]);
            }
            idDisplay.innerText = "üéØ Marker ID: " + idList.join(", ");
          } else {
            idDisplay.innerText = "üôà No Marker Detected";
          }

          requestAnimationFrame(process);
        }

        requestAnimationFrame(process);
      });
    }
  </script>
</body>
</html>


const uniCodeData = '✮⋆˙ Wings Junior : Test Yourself ✬';
const cardsData = [
    {
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },{
        id: 'Que 1: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 2: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    },

];
const cardsData1 = [
    {
        id: 'Que 3: ',
        question: 'What is the capital of France?',
        options: ['Berlin Berlin Berlin Berlin Berlin Berlin Berlin Berlin', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'A',
        image: 'image/pic.png',
        optionBig: 'y'
    }, {
        id: 'Que 4: ',
        question: 'What is the capital of France?',
        options: ['Berlin ', 'Madrid', 'Paris', 'Rome'],
        rightAnswer: 'D',
        image: 'image/pic.png',
        optionBig: ''
    }
];

function createCard(cardData) {
    const cardsContainer = document.querySelector('.cards');
    if (!cardsContainer) {
        console.error("❌ Error: No element with class 'cards' found.");
        return;
    }
    const card = document.createElement('div');
    card.classList.add('card');
    card.id = cardData.id;

    const topSection = document.createElement('div');
    topSection.classList.add('top-section');

    const logo = document.createElement('img');
    logo.src = 'image/logo.png';
    logo.classList.add('cardlogo');
    topSection.appendChild(logo);

    const uniCode = document.createElement('div');
    uniCode.innerText = `${uniCodeData || ''}`;
    uniCode.classList.add('uniCode');
    topSection.appendChild(uniCode);

    // ✅ "See Answer" Button Add
    const answerButton = document.createElement('button');
    answerButton.classList.add('see-answer');
    answerButton.innerText = "S";
    answerButton.onclick = function () {
        highlightAnswer(card, cardData.rightAnswer);
    };
    topSection.appendChild(answerButton);

    const buttons = document.createElement('div');
    buttons.classList.add('buttons');
    buttons.innerHTML = `
        <button class="rotate" onclick="storeDownloadCard('${cardData.id}')">⇨</button>
        <button onclick="shareCard('${cardData.id}')">⇨</button>
    `;
    topSection.appendChild(buttons);
    card.appendChild(topSection);

    const middleSection = document.createElement('div');
    middleSection.classList.add('middle-section');

    const question = document.createElement('div');
    question.classList.add('question');
    question.innerHTML = `<p><span class="bold">${cardData.id}</span> ${cardData.question}</p>`;
    middleSection.appendChild(question);

    if (cardData.image) {
        const imageContainer = document.createElement('div');
        imageContainer.classList.add('image-container');
        const img = document.createElement('img');
        img.src = cardData.image;
        imageContainer.appendChild(img);
        middleSection.appendChild(imageContainer);
    }
    card.appendChild(middleSection);

    const bottomSection = document.createElement('div');
    bottomSection.classList.add('bottom-section');

    if (cardData.optionBig) {
        bottomSection.classList.add('bottom-section-col');
    }

    const leftOptions = document.createElement('div');
    leftOptions.classList.add('left-options');
    leftOptions.innerHTML = `<div class="option" data-option="A">A. ${cardData.options[0]}</div>
                             <div class="option" data-option="B">B. ${cardData.options[1]}</div>`;

    const rightOptions = document.createElement('div');
    rightOptions.classList.add('right-options');
    rightOptions.innerHTML = `<div class="option" data-option="C">C. ${cardData.options[2]}</div>
                              <div class="option" data-option="D">D. ${cardData.options[3]}</div>`;

    bottomSection.appendChild(leftOptions);
    bottomSection.appendChild(rightOptions);
    card.appendChild(bottomSection);
    cardsContainer.appendChild(card);
}

// ✅ Function to Highlight Correct Answer
function highlightAnswer(card, correctAnswer) {
    const options = card.querySelectorAll('.option');
    options.forEach(option => {
        if (option.dataset.option === correctAnswer) {
            option.style.backgroundColor = "#c0ffb78f"; // ✅ Highlight Right Answer 
        } else {
            option.style.backgroundColor = "#ffb0b78f"; // Dim Wrong Answers
        }
    });

    options.onclick = function () {
        highlightAnswer(card, cardData.rightAnswer);
    };
}

function storeDownloadCard(cardId) {
    const card = document.getElementById(cardId);
    const buttons = card.querySelector('.buttons');
    const logo = card.querySelector('.cardlogo');
    const answerButton = card.querySelector('.see-answer');
    const uniCode = card.querySelector('.uniCode');

    uniCode.style.display = 'block';
    answerButton.style.display = 'none';
    buttons.style.display = 'none'; // Hide buttons before capturing

    html2canvas(card).then(canvas => {
        let link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = cardId + '.png';
        link.click();

        answerButton.style.display = 'block';
        buttons.style.display = 'block'; // Show buttons again after download
        uniCode.style.display = 'none';
    });
}


function downloadCard(cardId, callback) {
    const card = document.getElementById(cardId);
    const buttons = card.querySelector('.buttons');
    buttons.style.display = 'none'; // Hide buttons before capturing
    const answerButton = card.querySelector('.see-answer');
    const uniCode = card.querySelector('.uniCode');

    uniCode.style.display = 'block';
    answerButton.style.display = 'none';
    buttons.style.display = 'none'; // Hide buttons before capturing


    html2canvas(card).then(canvas => {
        let imgData = canvas.toDataURL('image/png');
        buttons.style.display = 'block'; // Show buttons again after capturing
        answerButton.style.display = 'block';
        uniCode.style.display = 'none';

        if (callback) callback(imgData);
    });
}

function shareCard(cardId) {
    downloadCard(cardId, function (imgData) {
        let blob = dataURLToBlob(imgData);
        let file = new File([blob], 'card.png', { type: 'image/png' });
        let dataTransfer = new DataTransfer();
        dataTransfer.items.add(file);
        let input = document.createElement('input');
        input.type = 'file';
        input.files = dataTransfer.files;

        let shareData = {
            files: [file],
            title: "Word Card",
            text: "Check out this word card!"
        };

        if (navigator.canShare && navigator.canShare(shareData)) {
            navigator.share(shareData).catch(err => console.error("Error sharing image: ", err));
        } else {
            alert("Sharing not supported, please download and share manually.");
        }
    });
}

function dataURLToBlob(dataURL) {
    let arr = dataURL.split(','), mime = arr[0].match(/:(.*?);/)[1],
        bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    while (n--) {
        u8arr[n] = bstr.charCodeAt(n);
    }
    return new Blob([u8arr], { type: mime });
}
function startcreateCard(btn, cardsData) {
    cardsData.forEach(createCard);
    btn.style.display = 'none'; // Hide the clicked button


}
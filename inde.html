<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milk Man Background Location</title>
</head>
<body>
    <h1>Background Location Running...</h1>


    <button onclick="requestLocationPermission()">Enable Location</button>

    <script>
        function requestLocationPermission() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        console.log("Permission Granted");
                        registerServiceWorker();
                    },
                    (error) => {
                        console.error("Permission Denied:", error.message);
                        alert("Please allow location access for background tracking.");
                    }
                );
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
    
        function registerServiceWorker() {
            if ('serviceWorker' in navigator && 'PeriodicSyncManager' in window) {
                navigator.serviceWorker.register('service-worker.js')
                    .then(reg => {
                        console.log("Service Worker Registered");
    
                        navigator.serviceWorker.ready.then((sw) => {
                            sw.periodicSync.register("update-location", {
                                minInterval: 15 * 60 * 1000 // हर 15 मिनट में अपडेट
                            });
                        });
                    });
            } else {
                console.log("Background Sync Not Supported");
            }
        }
    </script>
    

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <script>
        // ✅ Firebase Configuration
        var firebaseConfig = {
            apiKey: "तुम्हारी_API_KEY",
            authDomain: "milk-man-24d97.firebaseapp.com",
            databaseURL: "https://milk-man-24d97-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "milk-man-24d97",
            storageBucket: "milk-man-24d97.appspot.com",
            messagingSenderId: "103608166782",
            appId: "तुम्हारा_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);

        // ✅ Service Worker Register करो
        if ('serviceWorker' in navigator && 'PeriodicSyncManager' in window) {
            navigator.serviceWorker.register('service-worker.js')
                .then(reg => {
                    console.log("Service Worker Registered");

                    // ✅ Background Sync Register करो
                    navigator.serviceWorker.ready.then((sw) => {
                        sw.periodicSync.register("update-location", {
                            minInterval: 15 * 60 * 1000 // हर 15 मिनट में अपडेट
                        });
                    });
                });
        } else {
            console.log("Background Sync Supported नहीं है");
        }
    </script>
</body>
</html>
